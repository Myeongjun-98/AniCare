<!DOCTYPE html>
<html lang="ko"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{fragment/default}">
<head>
  <th:block layout:fragment="css"></th:block>
  <th:block layout:fragment="script">
    <script th:inline="javascript">
      const boardJsonStr = /*[[${boardsJson}]]*/ [];
      const boards = JSON.parse(boardJsonStr);

      console.log("▶ boards:", boards);

    </script>
  </th:block>
</head>
<div layout:fragment="main" id="main"> <!-- ▼ main ▼ -->
  <div class="search-result-wrap">

    <!-- ▼ 검색 input ▼ -->
    <form method="get" role="search" th:object="${boardSearchForm}"
          th:action="@{/community/comsearch}">
        <div class="input-group-text">
          <input type="text" th:field="*{keyword}" class="search-input" placeholder="검색어를 입력해주세요.">

          <input type="hidden" th:field="*{boardType}">
          <input type="hidden" th:field="*{category}">
        </div>
    </form><!-- ▲ 검색 input 끝 ▲ -->


  <!-- ▼ 게시판 타입 ▼ -->
    <div class="boardType" style="display=flex; justify-content=center;">
      <a href="#" data-board-type="" class="boardType-link"> TOTAL </a>
      <a href="#" data-board-type="MEETING" class="boardType-link"> MEETING </a>
      <a href="#" data-board-type="ERRAND" class="boardType-link"> ERRAND </a>
    </div> <!-- ▲ 게시판 타입 끝 ▲ -->


    <!-- ▼ 게시판 카테고리 ▼ -->
    <div class="boardCategory-wrap">

      <!-- 모임 모집글 카테고리 -->
      <div class="boardCategory" style="display=flex; justify-content:center;">
        <a href="#" data-category="" class="category-link"> Total </a>
        <a href="#" data-category="Volunteer" class="category-link"> Volunteer </a>
        <a href="#" data-category="Walking" class="category-link"> Walking </a>
        <a href="#" data-category="Info" class="category-link"> Info </a>
      </div>

      <!-- 심부름 구인글 카테고리 -->
      <div class="boardCategory" style="display=flex; justify-content:center;">
        <a href="#" data-category="" class="category-link"> Total </a>
        <a href="#" data-category="Walking" class="category-link"> Walking </a>
        <a href="#" data-category="Petsitter" class="category-link"> Petsitter </a>
        <a href="#" data-category="Erranding" class="category-link"> Erranding </a>
      </div>
    </div> <!-- ▲ 게시판 카테고리 끝 ▲ -->

    <p th:text="|${boardSearchForm.keyword}에 대한 검색 결과:|"></p>

  <div class="orderBtn">
    <p style="display: inline;">인기순</p>
    <p style="display: inline;"> | </p>
    <p style="display: inline;">최신순</p>
  </div>

    <!-- ▼ 검색결과 게시글 리스트 ▼ -->
 <div class="result-list-wrap" id="boardListWrap">
<!--   <div class="result-list">-->
<!--     <p th:text="${board.boardTitle}"></p> &lt;!&ndash; 게시글 제목 &ndash;&gt;-->
<!--     <p th:text="${board.boardWriteDate}"></p> &lt;!&ndash; 게시글 작성일 &ndash;&gt;-->
<!--    <p th:text="${board.likeCount}"></p> &lt;!&ndash; 게시글 좋아요 수 &ndash;&gt;-->
<!--   </div>-->
  </div> <!-- ▲ 검색결과 게시글 리스트 끝 ▲ -->

    <script th:inline="javascript">
      let selectedBoardType = "";
      let selectedCategory = "";

      function render(list) {
        const boardListWrap = document.getElementById("boardListWrap");
        boardListWrap.innerHTML = "";
        list.forEach(p => {
          const el = document.createElement("div");
          el.classList.add("result-list");

          el.innerText = `
            <p>${p.boardTitle}</p>
            <p>${p.boardWriteDate}</p>
            <p>${p.likeCount}</p>
            `;

          boardListWrap.appendChild(el);
        });
      }

      function filterBoards() {
        const filtered = boards.filter(p => {
          return (!selectedBoardType || p.boardType === selectedBoardType) &&
                 (!selectedCategory || p.category === selectedCategory);
        });
        render(filtered);
      }

      document.querySelectorAll(".boardType-link").forEach(link => {
        link.addEventListener("click", function(e) {
          e.preventDefault();
          selectedBoardType = this.dataset.boardType;
          filterBoards();
        });
      });

      document.querySelectorAll(".category-link").forEach(link => {
        link.addEventListener("click",function(e) {
          e.preventDefault();
          selectedCategory = this.dataset.category;
          filterBoards();
        });
      });

      //초기 렌더링
      render(boards);
    </script>

  </div>
</div> <!-- ▲ main 끝 ▲ -->

</html>
